<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>TYPO3 UI Guides: Content Module JavaScript Architecture</title>

  <!-- guides styles -->
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
  <link rel="stylesheet" type="text/css" href="stylesheets/strobe.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/overrides.style.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/overrides.print.css" media="print" />
  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- syntax highlighting styles -->
  <link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/shThemeStrobeGuides.css" />
</head>
<body class="guide">

  <header role="banner">
    <div class="container">
      <h1 id="logo">
        <a href="http://typo3.org"><img src="images/header/logo.png" height="50" alt="TYPO3" /></a>
      </h1>
    </div>
  </header>

  <div id="feature">
    <div class="wrapper">
      <div class="feature_header">
        <h2><a href="/">TYPO3 UI Guides</a></h2>
        <p>These guides explain the concepts behind the Phoenix UI, and are a working tool for the developers to document the current status.</p>
      </div>
      <div class="feature_sidebar">
        <a href="index.html" id="guidesMenu">
          Guides Index <span id="guidesArrow">&#9656;</span>
        </a>
        <div id="guides" class="clearfix" style="display: none;">
          <a href="index.html" class="guidesMenu">
            Guides Index <span class="guidesArrow">&#9662;</span>
          </a>
          <hr style="clear:both;">
          <dl class="L">
    <dt>General</dt>
      <dd><a href="style_guide.html">JavaScript Style Guide</a></dd>
      <dd><a href="sproutcore.html">SproutCore tips &amp; tricks</a></dd>
    <dt>The Content Module</dt>
      <dd><a href="js_architecture.html">JavaScript Architecture</a></dd>
</dl>
<dl class="R">
</dl>


        </div>
      </div>
    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
          <div class="headerSection">
            <h2>Content Module JavaScript Architecture</h2>
<p>After reading this guide, you will be able to:</p>
<ul>
	<li>Understand the structure and ideas of the Content Module JavaScript architecture.</li>
</ul>

          </div>
        <h3 id="overall-ui-goals">1 Overall UI Goals</h3>
<p>We have set up the following goals to strive for UI-wise:</p>
<ul>
	<li>Reliable editing</li>
	<li>Predictable UI Behavior</li>
	<li>Immeditate feedback for the user</li>
	<li>Built with the web &#8211; for the web</li>
</ul>
<p>UI concepts should be evaluated against the above goals.</p>
<h3 id="technical-guidelines-goals">2 Technical guidelines / goals</h3>
<p>When implementing the user interface, we should follow these guidelines on a technical side:</p>
<ul>
	<li>Take the pragmatic approach</li>
	<li>Augument the frontend website</li>
	<li>No iFrame in the content module</li>
	<li>Browser support &gt;= IE9; in the prototyping phase focus on Firefox</li>
	<li>No polling of data from the server!</li>
</ul>
<h3 id="css-guidelines">3 <span class="caps">CSS</span> Guidelines</h3>
<p>Overal Goal:</p>
<ul>
	<li>Be pragmatic! We strive for solutions which work out-of-the-box in 95% of the cases; and tell the integrator   how to solve the other 5%. Thus, the integrator has to care to make his <span class="caps">CSS</span> work with Phoenix; we do not use a sandbox.</li>
</ul>
<p>Implementation notes:</p>
<ul>
	<li>All <span class="caps">CSS</span> selectors should be fully lowercase, with <code>-</code> as separator. Example: <code>t3-ui, t3-breadcrumb-item</code></li>
	<li>We use the <tt>t3-</tt> prefix</li>
	<li>The integrator is never allowed to override <tt>t3-</tt> and <tt>aloha-</tt></li>
	<li>The main UI elements have an ID, and a partial reset is used to give us predictable behavior inside them.</li>
	<li>We use <strong>sass</strong>. To install, use <tt>gem install sass</tt>. Then, before modifying <span class="caps">CSS</span>, go to css/ and run   <tt>sass --watch style.scss:style.css</tt>. This will update style.css at every modification of style.scss.</li>
</ul>
<h4 id="z-indexes">3.1 Z-Indexes</h4>
<p>The TYPO3 Phoenix UI uses Z-Indexes starting at <strong>10000</strong>.</p>
<div class="warning"><p><span class="caps">TODO</span>: Formulate some more about the usage of z-indexes.</p></div>
<h3 id="naming-of-main-ui-parts">4 Naming of main UI parts</h3>
<p>The following image shows the main UI parts and the names we use for them.</p>
<p><img src="images/content/js_architecture/ui_parts.png" alt="" /></p>
<h3 id="main-architecture">5 Main architecture</h3>
<p>The whole Content Module is built around the <strong>Aloha Blocks</strong>. Blocks are un-editable elements of a website, which are managed by Aloha. They can appear inside or outside editables, can be nested, and can appear either as inline element (<code>&lt;span&gt;</code>) or as block-level element(<code>&lt;div&gt;</code>).</p>
<p>Only one block is active at any given time. When a block is <strong>active</strong>, then all its parent blocks are <strong>selected</strong>. The <strong>block selection</strong> contains the active block as first element and all other selected blocks from innermost to outermost.</p>
<p>Most of the UI changes depending on the current block selection.</p>
<h4 id="ui-updates-on-selection-change">5.1 UI Updates on Selection Change</h4>
<p>The following diagram shows how the UI is changing when the block selection changes:</p>
<p><img src="images/content/js_architecture/internal_structure_ui_updates.png" alt="" /></p>
<ol>
	<li>The phoenixintegration Aloha Plugin (located in <code>alohaplugins/phoenixintegration/lib/phoenixintegration-plugin.js</code>) hooks   into the Aloha event which is triggered whenever the block selection changes. Whenever this event is triggered,   it calls <tt>T3.Content.Model.BlockSelection.updateSelection()</tt>.</li>
	<li>We need to wrap each Aloha Block with a <strong>SproutCore Block</strong> (later only called Block),   so we can attach event listeners to it. This wrapping is done by the <code>BlockManager</code></li>
	<li>The <code>BlockManager</code> either returns existing SproutCore Blocks (if the given Aloha Block has already been wrapped),   or creates a new one.</li>
	<li>Then, the <code>BlockSelection</code> sets its <code>content</code> property, which the UI is bound to. Thus,   all UI elements which depend on the current block selection are refreshed.</li>
</ol>
<h4 id="ui-updates-on-property-change">5.2 UI updates on property change</h4>
<p>When an attribute is modified through the property panel, the following happens:</p>
<p><img src="images/content/js_architecture/internal_structure_attribute_updates.png" alt="" /></p>
<div class="warning"><p><span class="caps">TODO</span>: Document what happens when an <strong>editable</strong> is modified</p></div>

<div class="warning"><p><span class="caps">TODO</span>: Document variable naming conventions: * $&#8230; &#8594; jQuery object</p></div>

<div class="warning"><p><span class="caps">TODO</span>: Document Node properties naming conventions a bit further</p></div>
<h5 id="node-property-naming-conventions">5.2.1 Node Property Naming Conventions</h5>
<ol>
	<li>Normal properties   Those properties contain normal values like a title, date or other value.   Serverside setting of the property is done using TYPO3CR Node::setProperty()</li>
	<li>Visibility / lifecycle properties   These properties are prefixed using an underscore, like &#8216;_hidden&#8217;.   Serverside setting of the property is done using TYPO3CR Node::set<UpperCamelCasePropertyname>()</li>
	<li>TYPO3 internal properties   These properties are prefixed with a double underscore, like __workspacename</li>
</ol>
<div class="warning"><p><span class="caps">TODO</span>: Document data exchange between server / BE / FE and how BE and FE work together</p></div>
<h4 id="saving-content">5.3 Saving content</h4>
<p>Saving is triggered using <code>T3.Content.Model.Changes.save()</code> and is very straight-forward. For now, we use ExtDirect to send things back to the server.</p>
<h3 id="displaying-modal-dialogs">6 Displaying Modal Dialogs</h3>
<div class="warning"><p><span class="caps">TODO</span> &#8211; write this</p></div>
<ul>
	<li><span class="caps">REST</span> architectural style</li>
	<li><span class="caps">HTML</span> snippets loaded via fixed URLs from server side</li>
	<li>Return Commands (<code>&lt;a rel="typo3-...." /&gt;</code>)</li>
</ul>
<h4 id="rest-server-side-api">6.1 <span class="caps">REST</span> Server Side <span class="caps">API</span></h4>
<p><span class="caps">URL</span> <tt>/typo3/content/new</tt></p>
<ul>
	<li><tt>referenceNode</tt> &#8211; Context node path</li>
	<li><tt>position</tt> &#8211; if <code>above</code>, new node will be inserted above <code>referenceNode</code>, if <code>below</code>, otherwise.</li>
</ul>
<p><span class="caps">URL</span> <tt>/typo3/content/create</tt></p>
<ul>
	<li>all options from <code>/typo3/content/new</code></li>
	<li><tt>type</tt> &#8211; TYPO3CR Node Type to be created</li>
</ul>
<h4 id="return-commands">6.2 Return Commands</h4>
<p>Command <tt>created-new-content</tt>:</p>
<div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">

	&lt;a rel=&quot;typo3-created-new-content&quot;
		data-page=&quot;/sites/phoenixdemotypo3org/homepage@user-admin&quot;
		href=&quot;/sites/phoenixdemotypo3org/homepage/main/4e1ef025442f5@user-admin&quot;&gt;
		Goto New Content
	&lt;/a&gt;
</pre></div><ul>
	<li><tt>href</tt> Context node path of newly created content</li>
	<li><tt>data-page</tt> Context node path of enclosing page</li>
</ul>
<div class="warning"><p><span class="caps">TODO</span>: should also include the <span class="caps">URL</span> of the nearest page, maybe even in <span class="caps">HREF</span>?</p></div>
<h3 id="changelog">7 Changelog</h3>
<ul>
	<li>July 11, 2011: Initial version by <a href="credits.html#skurfuerst">Sebastian Kurf√ºrst</a></li>
</ul>

      </div>
        <div id="subCol">
          <h3 class="chapter"><img src="images/strobe/chapters.png" alt="" />Chapters</h3>
          <ol class="chapters">
            <li><a href="#overall-ui-goals"><p>Overall UI Goals</p>
</a></li><li><a href="#technical-guidelines-goals"><p>Technical guidelines / goals</p>
</a></li><li><a href="#css-guidelines"><p><span class="caps">CSS</span> Guidelines</p>
</a><ul><li><a href="#z-indexes"><p>Z-Indexes</p>
</a></li></ul></li><li><a href="#naming-of-main-ui-parts"><p>Naming of main UI parts</p>
</a></li><li><a href="#main-architecture"><p>Main architecture</p>
</a><ul><li><a href="#ui-updates-on-selection-change"><p>UI Updates on Selection Change</p>
</a></li> <li><a href="#ui-updates-on-property-change"><p>UI updates on property change</p>
</a></li> <li><a href="#saving-content"><p>Saving content</p>
</a></li></ul></li><li><a href="#displaying-modal-dialogs"><p>Displaying Modal Dialogs</p>
</a><ul><li><a href="#rest-server-side-api"><p><span class="caps">REST</span> Server Side <span class="caps">API</span></p>
</a></li> <li><a href="#return-commands"><p>Return Commands</p>
</a></li></ul></li><li><a href="#changelog"><p>Changelog</p>
</a></li>
          </ol>
        </div>
    </div>
  </div>

  <hr class="hide" />
	  <footer>
	    <div class="container">
	      <div class="col">
	        <p>
	        	Templates based on <a href="https://github.com/sproutcore/sproutguides">SproutCore guides</a>.
	        </p>
	      </div>
	      <a href="#feature" class="top">Back To Top</a>
	    </div>
	  </footer>

  <script src="http://code.jquery.com/jquery-1.6.min.js" type="text/javascript" charset="utf-8"></script>
  <script type="text/javascript" src="javascripts/typo3Guides.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shCore.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushRuby.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushJScript.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushCss.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushXml.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushSql.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushPlain.js"></script>
  <script type="text/javascript">
    SyntaxHighlighter.all()
  </script>
</body>
</html>
